<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>TrustedForm + Retreaver Demo</title>
	<style>
		body {background-color: #253842; font-family: "proxima nova", sans-serif; color: #6fb3c1; width: 400px; margin: 0 auto; padding: 20px; font-size: 18px;}
		input {background-color: #6fb3c1!important; display: block; margin: 10px 0; min-width: 250px; padding: 6px 0; font-size: 14px;}
		input[type="text"], input[type="password"], input[type="email"], textarea {color: #fff;}
		#submit_test_form {background-color: #F37021; -webkit-border-radius: 4px; border: none; color: #fff; font-size: 14px;}
		a {color:#fff;}
	</style>
	<script type="text/javascript">
	    (function () {
	        var scriptElement = document.createElement('script');
	        scriptElement.type = 'text/javascript';
	        scriptElement.async = true;
	        scriptElement.defer = true;
	        scriptElement.src = document.location.protocol + '//dist.routingapi.com/jsapi/v1/retreaver.min.js';
	        scriptElement.onload = scriptElement.onreadystatechange = function () {

	            Retreaver.configure({
	                host: 'api.routingapi.com',
	                prefix: document.location.protocol == 'https:' ? 'https' : 'http'
	            });

	            // Your code goes here!
	            var campaign = new Retreaver.Campaign({campaign_key: 'b9c20ce75dc6cf5089064dc578ec12d6'});

	            campaign.request_number(function (number) {

					//These variables will store your form data, You must customize it to suit your form
					var first_name, last_name, email, phone_1, reference, xxTrustedFormCertUrl;
					          
					//Each field in your form comes with a label and a child input element, by going into the parent of the label, you can access the sub-elements 
					//From the parent of the label, you can find the input element within, pulling the value and using it to update the numbers tags
					function updateTags() {
					   first_name = document.getElementById('first_name').value();
					   last_name = document.getElementById('last_name').value();
					   email = document.getElementById('email').value();
					   phone_1 = document.getElementById('phone_1').value();
					   if(document.getElementById('xxTrustedFormCertUrl_0')){xxTrustedFormCertUrl_0 = document.getElementById('xxTrustedFormCertUrl_0').value()};
					   reference = document.getElementById('reference').value();

					   //update tags associated with displayed number, key:value - where key is created and managed within the retreaver platform, 
					   //and value is pulled from our previously stored variables
					   number.replace_tags({
					      first_name: first_name,
					      last_name: last_name,
					      email: email,
					      phone_1: phone_1,
					      reference: reference,
					      trustedform_cert_url: xxTrustedFormCertUrl
					   });
					}
					
					// run updateTags function before unloading the page
					document.getElementById('test_form').addEventListener("submit", function(){
						updateTags();
						number.initiate_call(phone_1, {first_name: first_name, email: email, dial: phone_1, live_agent: true}, callInitiated);
						function callInitiated(call) {}
					});

					
					var link = '<a href="tel:' + number.get('number') + '">' + number.get('formatted_number') + '</a>';
	                document.getElementById('phone-number').innerHTML = link;
	            });
	            // End your code... make sure to add <div id="phone-number"></div> somewhere in the body!
	        };
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(scriptElement);
	    })();
	</script>
</head>
<body>
	<div id="test-form">
        <h1>Brontosaurus FOREVER!</h1>
		<form method="post" id="test_form" name="test_form" action="https://app.leadconduit.com/flows/5b6e0c6c7caa03078d537875/sources/5bb3cc3328c2e33749876eeb/submit?redir_url=http%3A%2F%2Factiveprospect.com">
			<input type="text" name="first_name" id="first_name" placeholder="first name" value="Test">
			<input type="text" name="last_name" id="last_name" placeholder="last name" value="Customer">
			<input type="text" name="phone_1" id="phone_1" placeholder="phone" value="512.555.1234">
			<input type="text" name="email" id="email" placeholder="email" value="support@activeprospect.com">
            <input type="hidden" name="reference" id="reference" placeholder="reference code" value="I was raised by a cup of coffee">
			<button type="submit" id="submit_test_form">Contact Us</button>
		</form>
		<p>I hereby consent to receive <a href="https://en.wikipedia.org/wiki/Auto_dialer">autodialed</a> and/or pre-recorded telemarketing calls from or on behalf of Sample Company at the telephone number I provided above, including my wireless number, if applicable. I understand that consent is not a condition of purchase.</p>
		<p>Call <span id="phone-number"></span> for more details!</p>
	</div>
<!-- BEGIN Generate a TrustedForm Certificate -->
<script type="text/javascript">
(function() {
    var field = 'xxTrustedFormCertUrl';
    var provideReferrer = false;
    var tf = document.createElement('script');
    tf.type = 'text/javascript'; tf.async = true;
    tf.src = 'http' + ('https:' == document.location.protocol ? 's' : '') +
    '://api.trustedform.com/trustedform.js?provide_referrer=' + escape(provideReferrer) + '&field=' + escape(field) + '&l='+new Date().getTime()+Math.random();
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(tf, s); }
)();
</script>
<noscript>
    <img src="http://api.trustedform.com/ns.gif" />
</noscript>
<!-- END Generate a TrustedForm Certificate -->
<!-- non-standard Alert Code -->
<script type="text/javascript">
    function trustedFormCertUrlCallback(certificateUrl) {
        console.log(certificateUrl);
    }
</script>
<!-- END non-standard Alert Code -->

</body>
</html>